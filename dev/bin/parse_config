#!/bin/bash

PARSE_PATH=${1:-.}

rm -rf /etc/$PARSE_PATH

cd /app/config

find $PARSE_PATH -type d -exec sh -c 'mkdir -p /etc/$1' == {} \;
find $PARSE_PATH -type l -exec sh -c 'cp -d $1 /etc/$1' == {} \;
find $PARSE_PATH -type f -exec sh -c 'cat "$1" | templater > "/etc/$1"' -- {} \;